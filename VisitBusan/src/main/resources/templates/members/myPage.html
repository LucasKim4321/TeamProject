<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main</title>
</head>

<body>
    <div class="container mypage" layout:fragment="content">
        <h1>마이페이지</h1>
        <div class="mypage-top-box">
            <img src="images/mypage/profile_20240817.jpg" class="pro-img">
            <div class="pro-content">
                <h2 class="nick-name" th:text="${member.name}">홍길동</h2>
                <p class="email" th:text="${member.email}">test@gmail.com</p>
                <p class="mypage-comant" th:text="${member.profileText}">여유있는 여행자 홍길동</p>
                <div class="mypage-link">
                    <div class="profileBtn">내 정보 수정</div>
                    <div>알림함</div>
                </div>
            </div>
        </div>

        <ul class="tab-menu nav nav-tabs mypage-link mt-4" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <h3 class="active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" role="tab" aria-controls="home-tab-pane" aria-selected="false" tabindex="-1">
                    나의 리뷰
                </h3>
            </li>
            <li class="nav-item" role="presentation">
                <h3 class="" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" role="tab" aria-controls="profile-tab-pane" aria-selected="true">
                    찜한 여행지
                </h3>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade active show" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                <div class="mypage-bottom-box">
                    <div class="rev-inner-list">
                        <div class="row">
                            <div class="col rev-inner-item">
                            <div class="rev-img">
                                <img src="/images/mypage/image1.jpg" alt="이미지">
                            </div>
                            <div class="rev-content">
                                <div class="mypage-tag">#광안리해수욕장</div>
                                <div class="mypage-text">
                                    영화의 도시라는 별명이 있는 부산에서 영화의 전당을 다녀왔습니다.
                                    영화를 좋아한다면 영화의 전당에서 진행하는 영화제 등 행사도 참여해도 좋을 것 같습니다.
                                    평소에도 영화를 볼 수 있고 야외에서 볼 수 있는 공간도 따로 있어서 신기했습니다.
                                    공간자체도 예뻐서 사진 찍으러 오시는 분들도 꽤 많았습니다.
                                    영화를 좋아하신다면 방문해보기 좋은 코스로 추천드립니다!
                                </div>
                                <p class="mypage-date">2024.07.27</p>
                                <div class="mypage-star">
                                    5
                                </div>
                            </div>
                            </div>
                            <div class="col">
                            <div class="rev-img">
                                <img src="/images/mypage/image1.jpg" alt="이미지">
                            </div>
                            <div class="rev-content">
                                <div class="mypage-tag">#광안리해수욕장</div>
                                <div class="mypage-text">
                                    영화의 도시라는 별명이 있는 부산에서 영화의 전당을 다녀왔습니다.
                                    영화를 좋아한다면 영화의 전당에서 진행하는 영화제 등 행사도 참여해도 좋을 것 같습니다.
                                    평소에도 영화를 볼 수 있고 야외에서 볼 수 있는 공간도 따로 있어서 신기했습니다.
                                    공간자체도 예뻐서 사진 찍으러 오시는 분들도 꽤 많았습니다.
                                    영화를 좋아하신다면 방문해보기 좋은 코스로 추천드립니다!
                                </div>
                                <p class="mypage-date">2024.07.27</p>
                                <div class="mypage-star">
                                    5
                                </div>
                            </div>
                            </div>
                            <div class="col">
                            <div class="rev-img">
                                <img src="/images/mypage/image1.jpg" alt="이미지">
                            </div>
                            <div class="rev-content">
                                <div class="mypage-tag">#광안리해수욕장</div>
                                <div class="mypage-text">
                                    영화의 도시라는 별명이 있는 부산에서 영화의 전당을 다녀왔습니다.
                                    영화를 좋아한다면 영화의 전당에서 진행하는 영화제 등 행사도 참여해도 좋을 것 같습니다.
                                    평소에도 영화를 볼 수 있고 야외에서 볼 수 있는 공간도 따로 있어서 신기했습니다.
                                    공간자체도 예뻐서 사진 찍으러 오시는 분들도 꽤 많았습니다.
                                    영화를 좋아하신다면 방문해보기 좋은 코스로 추천드립니다!
                                </div>
                                <p class="mypage-date">2024.07.27</p>
                                <div class="mypage-star">
                                    5
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                <div class="mypage-bottom-box">
                    <div class="row">
                        <div class="col rev-inner-item">
                            <div class="rev-img">
                                <img src="/images/mypage/image1.jpg" alt="이미지">
                            </div>
                            <div class="rev-content">
                                <div class="mb-2 mt-4">겨울 호기심 천국 1박2일 체험 코스</div>
                                <button type="button" class="btn btn-primary btn-sm">바로가기</button>
                                <button type="button" class="btn btn-secondary btn-sm">찜하기 취소</button>
                            </div>
                        </div>
                        <div class="col rev-inner-item">
                            <div class="rev-img">
                                <img src="/images/mypage/image1.jpg" alt="이미지">
                            </div>
                            <div class="rev-content">
                                <div class="mb-2 mt-4">겨울 호기심 천국 1박2일 체험 코스</div>
                                <button type="button" class="btn btn-primary btn-sm">바로가기</button>
                                <button type="button" class="btn btn-secondary btn-sm">찜하기 취소</button>
                            </div>
                        </div>
                        <div class="col rev-inner-item">
                            <div class="rev-img">
                                <img src="/images/mypage/image1.jpg" alt="이미지">
                            </div>
                            <div class="rev-content">
                                <div class="mb-2 mt-4">겨울 호기심 천국 1박2일 체험 코스</div>
                                <button type="button" class="btn btn-primary btn-sm">바로가기</button>
                                <button type="button" class="btn btn-secondary btn-sm">찜하기 취소</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- class="tab-content" -->
            <!-- 페이지 버튼 -->
            <!-- class="tab-content" -->
            <!-- 페이지 버튼 -->
            <!--<nav aria-label="Page navigation">
                <ul class="pagination justify-content-center mt-4">

                    &lt;!&ndash; 불러올 이전 페이지가 있으면 활성화 &ndash;&gt;
                    <li th:if="${responseDTO.prev}" class="page-item">
                        <a class="page-link" href="#" th:data-num="${responseDTO.start-1}">Previous</a>
                    </li>

                    &lt;!&ndash; 해당 블럭의 시작 페이지 번호와 마지막 번호   시작번호 1 끝번호 10 &ndash;&gt;
                    &lt;!&ndash; th:each="i : ${#numbers.sequence(${pageResponseDTO.start}, ${pageResponseDTO.end}, +1)}" 이렇게 하면 에러 ${}안에 ${}또 넣으면 안됨 &ndash;&gt;
                    <th:block th:each="i : ${#numbers.sequence(responseDTO.start, responseDTO.end, +1)}">
                        <li class="page-item"
                            th:classappend="${responseDTO.page==i?'active':''}"> &lt;!&ndash;  &ndash;&gt;
                            <a class="page-link" href="#" th:data-num="${i}">[[${i}]]</a>
                        </li>
                    </th:block>

                    &lt;!&ndash; 불러올 다음 페이지가 있으면 활성화 &ndash;&gt;
                    <li th:if="${responseDTO.next}" class="page-item">
                        <a class="page-link" href="#" th:data-num="${responseDTO.end+1}">Next</a>
                    </li>

                </ul>
            </nav>-->
        </div>

        <!--회원 수정 팝업-->
        <div class="profileModal modal">
            <div class="modal-dialog">
                <div class="modal-content p-5">
                    <h2 class="text-center">회원정보 관리</h2>
                    <hr>
                    <form action="/modify" method="POST">
                        <input type="hidden" name="userId" value="${member.userId}">
                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputName" class="col-form-label">닉네임</label>
                            </div>
                            <div class="col">
                                <input type="text" id="inputName" name="name" value="${member.name}">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputEmail" class="col-form-label">이메일</label>
                            </div>
                            <div class="col">
                                <input type="email" id="inputEmail" name="email" value="${member.email}">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputAddress" class="col-form-label">주소</label>
                            </div>
                            <div class="col">
                                <input type="text" id="inputAddress" name="address" value="${member.address}">
                            </div>
                        </div>
                        <div class="row align-items-end mt-4 mb-4">
                            <div class="col">
                                <button type="button" class="btn btn-danger w-100" onclick="window.location.href='/mypage';">취소하기</button>
                            </div>
                            <div class="col">
                                <button type="submit" class="btn btn-primary w-100">회원정보 변경</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 회원 수정 팝업 -->
        <!--<div class="profileModal modal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content p-5">
                    <h2 class="text-center">회원정보 관리</h2>
                    <hr>
                    <form id="updateForm">
                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputUserId" class="col-form-label">Id</label>
                            </div>
                            <div class="col">
                                <input type="text" id="inputUserId" class="form-control" name="userId" placeholder="ID" disabled>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputName" class="col-form-label">닉네임</label>
                            </div>
                            <div class="col">
                                <input type="text" id="inputName" class="form-control" name="name">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputEmail" class="col-form-label">이메일</label>
                            </div>
                            <div class="col">
                                <input type="email" id="inputEmail" class="form-control" name="email">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-2">
                                <label for="inputAddress" class="col-form-label">주소</label>
                            </div>
                            <div class="col">
                                <input type="text" id="inputAddress" class="form-control" name="address">
                            </div>
                        </div>

                        <div class="row align-items-end mt-4 mb-4">
                            <div class="col">
                                <button type="button" class="btn btn-danger w-100 closeBtn">취소하기</button>
                            </div>
                            <div class="col">
                                <button type="submit" class="btn btn-primary w-100">회원정보 변경</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>-->

    </div>
    <script layout:fragment="myscript" th:inline="javascript">
        const profileModal = new bootstrap.Modal(document.querySelector('.profileModal'))
/*
        //열기
        document.querySelector('.profileBtn').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            profileModal.show();
        });
        //닫기
        document.querySelector('.closeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            profileModal.hide();
        });
*/
        document.querySelector('.profileBtn').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            const userId = document.querySelector('.nick-name').textContent; // 로그인한 사용자 ID


            // AJAX 요청으로 회원 정보 가져오기
            fetch(`/mypage/${userId}`)
                .then(response => response.json())
                .then(data => {
                    // 폼 필드에 데이터 채우기
                    document.querySelector('#inputUserId').value = data.userId;
                    document.querySelector('#inputName').value = data.name;
                    document.querySelector('#inputEmail').value = data.email;
                    document.querySelector('#inputAddress').value = data.address;

                    profileModal.show();
                })
                .catch(error => console.error('회원 정보 로드 실패:', error));
        });
        document.querySelector('#updateForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(e.target);

    fetch('/modify/', {
        method: 'POST',
        body: formData,
        headers: {
            'Accept': 'application/json'
        }
    })
    .then(response => response.text())
    .then(() => {
        profileModal.hide();
        window.location.href = '/mypage'; // 수정 후 페이지 이동
    })
    .catch(error => console.error('회원 정보 수정 실패:', error));
});
    </script>
</body>
 </html>